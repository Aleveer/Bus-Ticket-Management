<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reset Password</title>
</head>

<body>
    <h2>Reset Password</h2>
    <form id="resetPasswordForm" th:action="@{/auth/reset-password}" method="post">
        <input type="hidden" id="token" name="token" />
        <div>
            <label for="newPassword">New Password:</label>
            <input type="password" id="newPassword" name="newPassword" required />
        </div>
        <div>
            <label for="confirmPassword">Confirm New Password:</label>
            <input type="password" id="confirmPassword" name="confirmPassword" required />
        </div>
        <div>
            <button type="submit">Reset Password</button>
        </div>
    </form>
</body>

<script>
    // Function to get query parameters from the URL
    function getQueryParam(param) {
        let urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }

    // Set the token value from the URL
    document.getElementById("token").value = getQueryParam("token");

    document
        .getElementById("resetPasswordForm")
        .addEventListener("submit", function (event) {
            event.preventDefault();
            let token = document.getElementById("token").value;
            let newPassword = document.getElementById("newPassword").value;
            let confirmPassword = document.getElementById("confirmPassword").value;

            if (!newPassword) {
                alert("New password cannot be empty");
                return;
            }

            if (newPassword !== confirmPassword) {
                alert("Passwords do not match");
                return;
            }

            fetch("/auth/reset-password", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    token: token,
                    password: newPassword,
                }),
            })
                .then((response) => response.json())
                .then((data) => {
                    if (data.success) {
                        alert("Password has been reset successfully.");
                        window.location.href = "/auth/login";
                    } else {
                        alert("Failed to reset password: " + data.message);
                    }
                })
                .catch((error) => {
                    console.error("Error:", error);
                });
        });
</script>

</html>