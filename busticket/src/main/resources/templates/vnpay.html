<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <!-- mobile metas -->
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta name="viewport" content="initial-scale=1, maximum-scale=1">
   <!-- site metas -->
   <title>Easy Bus</title>
   <meta name="keywords" content="">
   <meta name="description" content="">
   <meta name="author" content="">
   <!--Bootstrap icon -->
   <link rel="stylesheet" th:href="@{https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css}">
   <!-- bootstrap css -->
   <link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap.min.css}">
   <!-- style css -->
   <link rel="stylesheet" type="text/css" th:href="@{/css/style.css}">
   <!-- Responsive-->
   <link rel="stylesheet" th:href="@{/css/responsive.css}">
   <!-- fevicon -->
   <link rel="icon" th:href="@{/images/fevicon.png}" type="image/gif" />
   <!-- Scrollbar Custom CSS -->
   <link rel="stylesheet" th:href="@{/css/jquery.mCustomScrollbar.min.css}">
   <!-- Tweaks for older IEs-->
   <link rel="stylesheet"
      th:href="@{https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/fontawesome.min.css}"
      integrity="sha384-NvKbDTEnL+A8F/AA5Tc5kmMLSJHUO868P+lDtTpJIeQdGYaUIuLr4lVGOEA1OcMy" crossorigin="anonymous">
   <!-- fonts -->
   <link th:href="@{https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap}" rel="stylesheet">
   <!-- font awesome -->
   <!-- <link rel="stylesheet" type="text/css" th:href="@{https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css}"> -->
   <!--  -->
   <link rel="stylesheet" th:href="@{/css/fontawesome.min.css}">
   <!-- owl stylesheets -->
   <link th:href="@{https://fonts.googleapis.com/css?family=Great+Vibes|Poppins:400,700&display=swap&subset=latin-ext}"
      rel="stylesheet">
   <link rel="stylesheet" th:href="@{/css/owl.carousel.min.css}">
   <link rel="stylesoeet" th:href="@{/css/owl.theme.default.min.css}">
   <link rel="stylesheet" th:href="@{https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css}"
      media="screen">
</head>

<body>
    <div class="d-flex justify-content-center">
        <i class="bi bi-check-circle-fill finish-check "></i>
    </div>
    <div class="d-flex justify-content-center">
        <h1 class="finish-title">Mua vé xe thành công</h1>
    </div>
    <div class="container">
        <div class="about_section">
            <div class="d-flex justify-content-center box-custom flex-wrap">
                <div class="info-title">
                    <h1 >THÔNG TIN MUA VÉ</h1>
                </div>
                <div class="d-flex bill-info flex-row full ">
                    <div class="info-row-1">
                        <h4>Họ và Tên:</h4>
                        <h4>Số điện thoại:</h4>
                        <h4>Email:</h4>
                    </div>
                    <div class="info-row-2">
                        <h4>Tổng giá vé:</h4>
                        <h4>PTTT: <p>VNPAY</p></h4>
                        <h4>Trạng thái: <p>Thanh Toán Thành Công</p></h4>
                    </div>
                    <input type="hidden" id="payment_date" name="payment_date" th:value="${paymentTime}">
                </div>
            </div>
        </div>
    </div>                    
</body>


<script>
    function getCookie(name) {
        const value = ; ${document.cookie};
        const parts = value.split(; ${name}=);
        if (parts.length === 2) return parts.pop().split(';').shift();
        return null;
    }

    const bookingInfoCookie = getCookie('bookingInfo');
    if (bookingInfoCookie) {
        const bookingInfo = JSON.parse(bookingInfoCookie);
        console.log(bookingInfo);  // In thông tin vé đã lưu
    } else {
        console.log("Không tìm thấy thông tin booking.");
    }

    // Gọi POST method để lưu thông tin BookingInfoDTO từ session
    (async function confirmBooking() {
        try {
            const response = await fetch('/home/index/booking/oneway-payment/save', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(getCookie('bookingInfo'))
            });

            if (response.ok) {
                const message = await response.text();
                console.log('Success:', message);
                alert('Đặt vé thành công: ' + message);

                // Redirect tới trang xác nhận nếu cần
                //window.location.href = '/bookings/confirmation';
            } else {
                console.error('Failed to confirm booking:', response.status);
                alert('Lỗi khi lưu thông tin đặt vé.');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Đã xảy ra lỗi. Vui lòng thử lại.');
        }
    })();


</script>

</html>